<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:itm="http://java.sun.com/jsf/composite/components">



	<h:form>
		<div class="col-md-12">
			<div class="card card-accent-info">
				<div class="card-header">
					<i class="fa fa-newspaper-o" /><strong>#{resources['label.global.minhasinformacoes']}</strong>
				</div>
				<div class="card-block">
					<div class="row">
						<div class="col-sm-4">
							<div class="form-group">
								<label for="formCliente:cliente_nome">#{resources['label.global.nome']}:</label><br />
								#{homeController.homeTO.cliente.nome}
							</div>
						</div>
						<h:panelGroup id="idTipoPessoa" styleClass="col-sm-8">
							<ui:fragment
								rendered="#{homeController.homeTO.cliente.tipoPessoa.name eq 'FISICA'}">
								<div class="form-group">
									<label>#{resources['label.global.cpf']}:</label><br />#{homeController.homeTO.cliente.cpfCnpj}
								</div>
							</ui:fragment>
							<ui:fragment
								rendered="#{homeController.homeTO.cliente.tipoPessoa.name eq 'JURIDICA'}">
								<div class="col-sm-8">
									<div class="form-group">
										<label>#{resources['label.global.cnpj']}:</label>
										#{homeController.homeTO.cliente.cpfCnpj}
									</div>
								</div>
							</ui:fragment>
						</h:panelGroup>
					</div>

					<div class="row">
						<div class="col-sm-4">
							<div class="form-group">
								<label for="formCliente:cliente_telefone_celular">#{resources['label.global.endereco']}:</label><br />
								#{homeController.homeTO.cliente.endereco}
							</div>
						</div>
						<div class="col-sm-1">
							<div class="form-group">

								<label>#{resources['label.global.numero']}:</label><br />
								#{homeController.homeTO.cliente.numeroEndereco}
							</div>
						</div>
						<div class="col-sm-4">
							<div class="form-group">
								<label for="formCliente:cliente_telefone_celular">#{resources['label.global.bairro']}:</label><br />
								#{homeController.homeTO.cliente.bairro}
							</div>
						</div>
						<div class="col-sm-1">
							<div class="form-group">
								<label for="formCliente:cliente_telefone_cidade">#{resources['label.global.cidade']}:</label><br />
								#{homeController.homeTO.cliente.cidade}
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-sm-4">
							<div class="form-group">
								<label for="formCliente:cliente_telefone_celular">#{resources['label.global.celular']}:</label><br />
								#{homeController.homeTO.cliente.telefoneCelular}
							</div>
						</div>
						<div class="col-sm-2">
							<div class="form-group">
								<label for="formCliente:cliente_email">#{resources['label.global.email']}:</label><br />
								#{homeController.homeTO.cliente.email}
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
		<ui:repeat var="contrato" value="#{customIdentity.cliente.contratos}"
			varStatus="status">
			
			<h2 class="text-center"><br /><br />##{contrato.identificador}</h2>
			<h4 class="text-center">(#{contrato.status.name})</h4>
			<div class="col-md-12 mb-2">
				<ul class="nav nav-tabs" role="tablist">
					<li class="nav-item">
					    <a class="nav-link active"
							data-toggle="tab" href="#home4_#{contrato.id}" role="tab"
							aria-controls="home"><i class="icon-calculator"></i> Dados
								Gerais <span class="badge badge-success">New</span></a>
					</li>
					
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#profile4_#{contrato.id}" role="tab" aria-controls="profile">
								<i class="icon-basket-loaded"></i>Boletos em aberto
								<span class="badge badge-pill badge-danger">#{homeController.calcularQtdBoletoAberto(contrato)}</span>
							</a>
						</li>
					
					<ui:fragment rendered="#{homeController.calcularQtdBoletoAberto(contrato) > 0}">	
					<li class="nav-item"><a class="nav-link" data-toggle="tab"
						href="#messages4_#{contrato.id}" role="tab"
						aria-controls="messages"><i class="icon-pie-chart"></i>
							#{resources['label.global.promessapagamento']}</a></li>
					</ui:fragment>		 
				</ul>

				<div class="tab-content">
					<div class="tab-pane active" id="home4_#{contrato.id}"
						role="tabpanel">

						<div class="card card-accent-info">
							<div class="card-header">
								<i class="fa fa-user" /> <strong>#{resources['label.global.informacoes']}</strong>
							</div>
							<div class="card-block">
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label for="formContrato:contrato_nome">#{resources['label.global.identificador']}:</label><br />
											#{contrato.identificador}
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label for="formContrato:contrato_diamesvencimento">#{resources['label.global.diamesvencimento']}:</label><br />
											#{contrato.diaMesVencimento}
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="card card-accent-info">
							<div class="card-header">
								<i class="fa fa-user" /> <strong>#{resources['label.global.produtos']}</strong>
							</div>
							<div class="card-block">
								<div class="row">
									<table id="idDataTableContratoProduto"
										class="table table-bordered">

										<thead>
											<tr>
												<th scope="col">#{resources['label.global.data']}</th>
												<th scope="col">#{resources['label.global.nome']}</th>
												<th scope="col">#{resources['label.global.valortotal']}</th>
												<th scope="col">#{resources['label.global.datainicio']}</th>
												<th scope="col">#{resources['label.global.datafim']}</th>
											</tr>
										</thead>
										<ui:repeat var="contratoProduto"
											value="#{contrato.contratoProdutos}">

											<tr
												class="#{contratoProduto.vigente?'card-success-clean':''}">
												<td><h:outputText
														value="#{contratoProduto.dataCriacao}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText></td>
												<td><h:outputText
														value="#{contratoProduto.produto.nome}" /></td>
												<td><h:outputText value="#{contratoProduto.valor}">
														<f:convertNumber pattern="#,##0.00" />
													</h:outputText></td>
												<td><h:outputText value="#{contratoProduto.dataInicio}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText></td>
												<td><h:outputText value="#{contratoProduto.dataFim}">
														<f:convertDateTime pattern="dd/MM/yyyy" />
													</h:outputText></td>
											</tr>
										</ui:repeat>
									</table>
								</div>
							</div>
						</div>


					</div>
					<div class="tab-pane" id="profile4_#{contrato.id}" role="tabpanel">
						
						<ui:fragment rendered="#{contrato.boletos eq null or empty contrato.boletos}">
								<p>Parabéns, você não possui boletos em aberto. </p>
						</ui:fragment>
					
						<h:dataTable id="idDataTableContratoBoleto" rendered="#{contrato.boletos ne null and  not empty contrato.boletos}" 
								value="#{contrato.boletos}" var="boleto" styleClass="table table-bordered table-striped">
								<h:column>
									<f:facet name="header">#{resources['label.global.datavencimento']}</f:facet>
									<h:outputText value="#{boleto.dataVencimento}">
										<f:convertDateTime pattern="dd/MM/yyyy" />
									</h:outputText>
								</h:column>
								<h:column>
									<f:facet name="header">#{resources['label.global.status']}</f:facet>
									<h:outputText value="#{boleto.status.name}" />
								</h:column>
								<h:column>
									<f:facet name="header">#{resources['label.global.valor']}</f:facet>
									<h:outputText value="#{boleto.valor}">
										<f:convertNumber pattern="#,##0.00" /> 
									</h:outputText>
								</h:column>
								<h:column>
									
									<f:facet name="header">#{resources['label.global.acoes']}</f:facet>
									<ui:fragment rendered="#{boleto.status.name eq 'ABERTO'}">
									
										<ui:fragment rendered="#{boleto.dataVencimento le homeController.homeTO.dataAtual}">
											<h:commandLink  styleClass="btn btn-secondary" action="#{homeController.downloadSegundaViaBoleto(boleto)}">
												<i class="fa fa-download"></i> #{resources['label.global.segundavia']}
											</h:commandLink>  
										</ui:fragment>	
										
										<ui:fragment rendered="#{boleto.dataVencimento ge homeController.homeTO.dataAtual}">
											<h:outputText value=" " />
											<h:commandLink  styleClass="btn btn-secondary" action="#{homeController.downloadBoleto(boleto)}">
												<i class="fa fa-download"></i> #{resources['label.global.download']}
											</h:commandLink> 
											<h:outputText value=" " />
											<h:commandLink styleClass="btn btn-secondary" action="#{homeController.enviarEmail(boleto)}">
												<i class="fa fa-envelope-o"></i> #{resources['label.global.receberviaemail']} 
											</h:commandLink>
											<h:outputText value=" " />
											<h:commandLink styleClass="btn btn-secondary" action="#{homeController.enviarSMS(boleto)}">
												<i class="fa fa-commenting-o"></i> #{resources['label.global.receberviasms']} 
											</h:commandLink>
										</ui:fragment>
									</ui:fragment>
								</h:column>
							</h:dataTable>
					</div>
					
					<ui:fragment rendered="#{homeController.calcularQtdBoletoAberto(contrato) > 0}">
						<div class="tab-pane" id="messages4_#{contrato.id}" role="tabpanel">
							<ui:fragment rendered="#{contrato.dataParaBloqueio eq null}">
								<p>A promessa de pagamento permite que sua internet seja desbloqueada temporariamente, permitindo que você efetue o pagamento.</p>
								<p>Caso o pagamento não seja identificado nesse periodo, será bloqueada novamente.</p>
								<br />
									<h:commandLink styleClass="btn btn-secondary" action="#{homeController.promessaPagamento(contrato)}">
										<i class="fa fa-commenting-o"></i> #{resources['label.global.cliqueaquiprometerpagamento']} 
									</h:commandLink>
							</ui:fragment>	
							<ui:fragment rendered="#{contrato.dataParaBloqueio ne null}">
								<p>Promessa de pagamento ja registrada!</p>							
							</ui:fragment>
						</div>
					</ui:fragment>
					
					
				</div>
			</div>
		</ui:repeat>
	</h:form>
	
</ui:composition>
